<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="./index.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

        <title>DS 220 Project #2 - Aryan Sinha</title>
    </head>
    <body>
        <header>
            <h1>DS 220 Project #2</h1>
            <h2>Aryan Sinha</h2>
        </header>
        <main>
            <p>This page is the website portion of my DS 220 Project #2 submission. This project required me to:
                <ul>
                    <li>Identify a raw public dataset of interest to me and download the raw data to my computer.</li>
                    <li>Frame some 6 to 10 questions that me or others in the area may want to answer analyzing this data.</li>
                    <li>Load my data set into a Pandas DataFrame and do some preprocessing and cleaning if needed.</li>
                    <li>Perform exploratory data analysis & visualization.</li>
                    <li>Map my questions as queries on the Pandas dataframe to generate answers.</li>
                    <li>Derive insight(s) using answers to my questions.</li>
                    <li>Communicate those insights as actionable text or a story that may be easy to communicate and share with others in the same dataset.</li>
                    <li>Publish my work on GitHub pages at a reachable URL.</li>
                </ul>
                For this project, I have chosen to use the SmashData Ultimate Player Database (which can be downloaded from <a href="https://github.com/smashdata/ThePlayerDatabase">here</a>). I have specifically chosen to use <a href="https://github.com/smashdata/ThePlayerDatabase/releases/tag/v2023.11.26">this release</a>, which was published on November 27, 2023 and includes data up through November 26, 2023. This dataset is of great interest to me, as I am an active member of the Super Smash Bros. Ultimate community, both here at Penn State and outside of Penn State. I have met a lot of my closest friends through this community and feel that I, along with those friends and other members of the community, would be able to gain a lot from my analysis on this dataset. This dataset contains historical data on players and tournaments.
                <br />
                <br />
                The data is stored in an SQLite database, meaning all relevant data must be acquired from said database. The said database contains the following tables:
                <ul>
                    <li><code>players</code>, which contains information about players.</li>
                    <li><code>ranking</code>, which contains ranking information about players.</li>
                    <li><code>ranking_seasons</code>, which contains ranking information about players each season.</li>
                    <li><code>sets</code>, which contains information about tournament sets.</li>
                    <li><code>tournaments</code>, which contains information about tournaments.</li>
                </ul>
                For this project, I will only be using the <code>players</code>, <code>sets</code>, and <code>tournaments</code> tables, as they are the most relevant for my use case.
                <br />
                <br />
                The questions I plan to answer with this assignment are as follows:
                <ol>
                    <li>How has the average number of entrants for tournaments changed over time?</li>
                    <li>Who are the most played characters of all time?</li>
                    <li>How has a character's win-rate changed over time?</li>
                    <li>How has a character's popularity changed over time?</li>
                    <li>How has a player's game win-rate changed over time?</li>
                    <li>How has a player's set win-rate chagned over time?</li>
                </ol>
            </p>
            <article>
                <h1>How has the average number of entrants for tournaments changed over time?</h1>
                <p>
                    For all questions, we first need to query the database for the specified data. This question would use the following query:
                    <pre>
                        <code class="language-sql">/* Get the month and the average number of entrants that month */
SELECT STRFTIME('%m-%Y', start, 'unixepoch'), AVG(entrants)
/* From the tournament_info table */
FROM tournament_info
/* Where the tournament started on or after the game's launch */
WHERE start >= 1544158800
/* Group by month */
GROUP BY STRFTIME('%m-%Y', start, 'unixepoch')
/* Order by the start of the tournament in ascending order */
ORDER BY start ASC;</code>
                    </pre>
                    This does include some form of data cleaning, as there are a few tournaments that are listed as starting before December 7, 2018 (the game's release date). We obviously don't want to include these, as they likely include incorrect/inaccurate data.
                    <br />
                    <br />
                    From there, we can load the data into a DataFrame using the following code:
                    <pre>
                        <code class="language-python">import sqlite3 as sqlite

# Connect to the database
conn = sqlite.connect("ultimate_player_database.db")
cursor = conn.cursor()

# Query the average number of entrants each month
query = """
SELECT STRFTIME('%m-%Y', start, 'unixepoch'), AVG(entrants)
FROM tournament_info
WHERE start >= 1544158800
GROUP BY STRFTIME('%m-%Y', start, 'unixepoch')
ORDER BY start ASC;
"""

# Execute the query
cursor.execute(query)
average_entrants_over_time = cursor.fetchall()

# Close the connection to the database
cursor.close()
conn.close()

import pandas as pd

# Import the data into a DataFrame
average_entrants_over_time_df = pd.DataFrame(average_entrants_over_time, columns=["Month", "Average Entrants"])

# Convert the dates from %m-%Y format to %B %Y format
average_entrants_over_time_df["Month"] = pd.to_datetime(average_entrants_over_time_df["Month"], format="%m-%Y")
average_entrants_over_time_df["Month"] = average_entrants_over_time_df["Month"].dt.strftime("%B %Y")</code>
                    </pre>
                    Afterwards, we can export the data to a CSV file, as well as graph it using Matplotlib.
                    <pre>
                        <code class="language-python"># Export the data to a CSV file
average_entrants_over_time_df.to_csv("data/average_entrants_per_month.csv")

import matplotlib.pyplot as plt

# Create a line plot and a scatter plot with the data
plt.title("Average Number of Entrants Over Time")
plt.xlabel("Month")
plt.ylabel("Average Number of Entrants")
plt.xticks(rotation=90)
plt.plot(average_entrants_over_time_df["Month"].values, average_entrants_over_time_df["Average Entrants"].values)
plt.scatter(average_entrants_over_time_df["Month"].values, average_entrants_over_time_df["Average Entrants"].values)
plt.show()
                        </code>
                    </pre>
                    This code will generate a chart like this:
                    <br />
                    <canvas id="average_entrants_per_month_chart" style="width: 100%;"></canvas>
                    <script type="module" src="average_entrants_per_month_chart.js"></script>
                    <br />
                    As you can see, there is a very strong downwards trend. It's easy to look at this and say the game is "dying" (losing its competitive popularity). However, this data does not identify the number of tournaments occurring each month, nor does it identify the total number of entrants each month. The former can be found using the following query and similar Python code:
                    <pre>
                        <code class="language-sql">/* Select the month and the number of tournaments */
SELECT STRFTIME('%m-%Y', start, 'unixepoch'), COUNT(*)
/* From the tournament_info table */
FROM tournament_info
/* That started after the game's release */
WHERE start >= 1544158800
/* Grouped by months */
GROUP BY STRFTIME('%m-%Y', start, 'unixepoch')
/* In order of start time in ascending order */
ORDER BY start ASC;</code>
                    </pre>
                    Graphing this data using similar code as from before, we get this graph:
                    <br />
                    <canvas id="tournaments_per_month_chart" style="width: 100%;"></canvas>
                    <script type="module" src="tournaments_per_month_chart.js"></script>
                    <br />
                    The latter can found using the following query (and again, similar Python code):
                    <pre>
                        <code class="language-sql">/* Select the month and the total number of entrants that month */
SELECT STRFTIME('%m-%Y', start, 'unixepoch'), SUM(entrants) 
/* From the tournament_info table */
FROM tournament_info 
/* That started after the game's release */
WHERE start > 1544158800 
/* Grouped by months */
GROUP BY STRFTIME('%m-%Y', start, 'unixepoch') 
/* In order of start time in ascending order */
ORDER BY start ASC;</code>
                    </pre>
                    Which generates the following graph:
                    <br />
                    <canvas id="total_entrants_per_month_chart" style="width: 100%;"></canvas>
                    <script type="module" src="total_entrants_per_month.js"></script>
                    <br />
                    As we can clearly see, there is an upwards trend for both the number of tournaments being run and the number of people entering tournaments. The game is not losing its competitive popularity. Rather, more people are running tournaments. The average number of entrants graph should not be used to determine if the game is "dying" or not, and should instead be used to predict how many entrants an average tournament should be getting. Furthermore, we could use this data to see potentially determine which months tend to have the most entrants. This data could also be used to determine other patterns and determine how certain events affected the game (for example, there is a large spike in April 2020 due to less tournaments being run, which was likely caused by the COVID-19 pandemic forcing everyone to move online).
                </p>
            </article>
            <article>
                <h1>Who are the most played characters of all time?</h1>
                <p>
                    This question requires the game data for each set in order to determine how many games were played by each character. First, this is the query we will be using:
                    <pre>
                        <code class="language-sql">/* Select the game data */
SELECT game_data
/* Select this data from the sets table */
FROM sets
/* Only select sets with valid game data */
WHERE game_data IS NOT NULL
  AND game_data != '[]';</code>
                    </pre>
                    After executing this query, we can put it into a DataFrame using teh following Python code:
                    <pre>
                        <code class="language-python">import sqlite3 as sqlite

# Connect to the database
conn = sqlite.connect("ultimate_player_database.db")
cursor = conn.cursor()

# Query the game data
query = """
SELECT game_data
FROM sets
WHERE game_data IS NOT NULL
  AND game_data != '[]';
"""

# Execute the query and convert the output from a list of tuples to a list of strings
cursor.execute(query)
sets = cursor.fetchall()
sets = [ set_json[0] for set_json in sets ]

# Close the connection to the database
cursor.close()
conn.close()

# Count the number of games reported for each character
played_dict = dict()

# A dictionary containing the cleaned names ofall of the characters
character_name_dict = { ... }

import json

# For each of the reported sets
for set_json in sets:
    # Get the game data
    game_data = json.loads(set_json)

    # For each game in the set
    for game in game_data:
        # Get the reported winner and loser characters
        winner_char = character_name_dict[game["winner_char"]]
        loser_char = character_name_dict[game["loser_char"]]
    
        # Update the winner character's game count
        if winner_char is not None:
            if winner_char not in played_dict:
                played_dict[winner_char] = 0
            
            played_dict[winner_char] += 1
        
        # Update the loser character's game count
        if loser_char is not None:
            if loser_char not in played_dict:
                played_dict[loser_char] = 0
            
            played_dict[loser_char] += 1
        
# Sort the play count dictionary by game count descending
played_dict = sorted(played_dict.items(), reverse=True, key=lambda character: character[1])

import pandas as pd

# Convert the dictionary to a DataFrame
game_count_df = pd.DataFrame(played_dict, columns=["Character", "Games Reported"])</code>
                    </pre>
                    Afterwards, we can export this data to a CSV file and graph it:
                    <pre>
                        <code class="language-python"># Export the data to a CSV file
game_count_df.to_csv("data/most_popular_characters_of_all_time.csv")

import matplotlib.pyplot as plt

# Plot the data
plt.title("Popularity of Characters")
plt.xlabel("Character")
plt.ylabel("Games Reported")
plt.xticks(rotation = 90)
plt.bar(game_count_df["Character"].values, game_count_df["Games Reported"].values)
plt.show()</code>
                    </pre>
                    This gives a graph like this:
                    <br />
                    <canvas id="most_popular_characters_of_all_time_chart" style="width: 100%;"></canvas>
                    <script type="module" src="most_popular_characters_of_all_time.js"></script>
                    <br />
                    As we can see in the graph, the 5 most popular characters are:
                    <ol>
                        <li>Joker</li>
                        <li>Cloud</li>
                        <li>Bowser</li>
                        <li>Palutena</li>
                        <li>Ness</li>
                    </ol>
                    I feel as though all of these characters make sense. The former best player in the world, MKLeo, used to play Joker. Many players would likely want to emulate him, leading them towards this character. Cloud is also a very popular pick for a similar reason, this time with a current contender for one of the best players in the world, Sparg0. Bowser, Palutena, and Ness are all considered to be relatively easy characters, making them popular choices for many players. I am surprised not to see Steve, R.O.B., or Kazuya in the top 5, as all of these characters are considered to be the most "meta relevant."
                </p>
            </article>
            <article>
                <h1>How has a character's win-rate changed over time?</h1>
            </article>
            <article>
                <h1>How has a character's popularity changed over time?</h1>
            </article>
            <article>
                <h1>How has a player's game win-rate changed over time?</h1>
            </article>
            <article>
                <h1>How has a player's set win-rate changed over time?</h1>
            </article>
        </main>
        <footer>

        </footer>
        <script>hljs.highlightAll();</script>
    </body>
</html>